C51 COMPILER V9.60.0.0   DS1302                                                            07/17/2021 11:59:44 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\ds1302.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\ESC51_sdk\OFC_Driver\ds1302.c LARGE WARNINGLEVEL(1) OPTIMIZE(8,SPE
                    -ED) BROWSE INCDIR(..\..\ESC51_sdk\es_sdkstatrt;..\..\ESC51_sdk\OFC_Driver\header;..\..\ESC51_sdk\HW_Support\header;..\..
                    -\ESC51_sdk\SW_Support\header;..\..\ESC51_project;..\..\ESC51_sdk) DEBUG OBJECTEXTEND PRINT(.\Listings\ds1302.lst) OBJECT
                    -(.\Objects\ds1302.obj)

line level    source

   1          #include "ds1302.h"
   2          
   3          #ifdef DS1302_CONFIG
              
              
              uchar code READ_RTC_ADDR[7]  = {0x81, 0x83, 0x85, 0x87, 0x89, 0x8b, 0x8d}; 
              uchar code WRITE_RTC_ADDR[7] = {0x80, 0x82, 0x84, 0x86, 0x88, 0x8a, 0x8c};
              
              /*------------------------------------------------
                               DS1302写字节函数
              ------------------------------------------------*/
              void DS1302_WriteByte(uchar dat)
              {
                      uchar i;
                      for(i = 0;i < 8;i++)
                      {
                              DS1302_CLK  = 0;
                              DS1302_Data = dat & 0x01;
                              dat       >>= 1;
                              DS1302_CLK  = 1;
                      }
              }
              /*------------------------------------------------
                              DS302写数据函数
              ------------------------------------------------*/
              void DS1302_Write(uchar addr,uchar dat)
              {
                      DS1302_RST   = 0;
                      _nop_();
                      DS1302_CLK   = 0;
                      _nop_();
                      DS1302_RST   = 1;
                      _nop_();
                      DS1302_WriteByte(addr);
                      DS1302_WriteByte(dat);
                      DS1302_RST   = 0;
              }
              /*------------------------------------------------
                               DS1302读数据函数
              ------------------------------------------------*/
              uchar DS1302_Read(uchar addr)
              {
                      uchar i;
                      uchar mask = 0x00;
                      DS1302_RST   = 0;
                      DS1302_CLK   = 0;
                      DS1302_RST   = 1;
                      DS1302_WriteByte(addr);
                      for(i = 0;i < 8;i++)
                      {
                              if(DS1302_Data) {
                                      mask  |= 0x80;
C51 COMPILER V9.60.0.0   DS1302                                                            07/17/2021 11:59:44 PAGE 2   

                              }
                              mask     >>= 1;
                              DS1302_CLK = 1;
                              DS1302_CLK = 0;
                      }
                      DS1302_CLK   = 1;
                      DS1302_RST   = 0;
                      return mask;
              }
              
              void DS1302_Init(void)
              {
                      uchar n;
                      uchar TIME[7] = {0, 0, 0x12, 0x01, 0x01, 0x02, 0x13};
                      DS1302_Write(0x8E,0X00);
                      for (n=0; n<7; n++) {
                              DS1302_Write(WRITE_RTC_ADDR[n],TIME[n]);        
                      }
                      DS1302_Write(0x8E,0x80);
              }
              
              #endif /* DS1302_CONFIG */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
